const passive={passive:!0},rwdStyle=window.getComputedStyle(document.documentElement),rwdMin=parseFloat(rwdStyle.getPropertyValue("--rl")),rwdMax=parseFloat(rwdStyle.getPropertyValue("--rh")),rwdrange=rwdMax-rwdMin,rwd=()=>document.documentElement.style.setProperty("--r",Math.min(1,Math.max(0,parseFloat(window.getComputedStyle(document.documentElement,"::before").getPropertyValue("width"))-rwdMin)/rwdrange).toString());rwd(),window.addEventListener("resize",rwd,passive);const ScrollbarWidth=()=>{const e=document.createElement("div");e.style.setProperty("overflow","scroll"),e.style.setProperty("position","absolute"),e.style.setProperty("left","-300vw"),document.documentElement.appendChild(e),document.documentElement.style.setProperty("--sw",e.offsetWidth.toString()),document.documentElement.removeChild(e)};ScrollbarWidth();const settingsData={border_width:"",theme:"",contrast:"",data:""},loadedSettingsData=JSON.parse(sessionStorage.getItem("settings")??localStorage.getItem("settings")??"{}");for(const e of Object.keys(settingsData))loadedSettingsData[e]&&(settingsData[e]=loadedSettingsData[e]);const Settings=()=>{window.so.addEventListener("click",(e=>{window.sd.showModal(),document.body.classList.add("so"),window.sd.children[0].scrollTo(0,0)})),window.sc.addEventListener("click",(e=>{window.sd.close(),document.body.classList.remove("so")})),SettingsUpdateForm(),window.sout.textContent=sessionStorage.getItem("settings")??localStorage.getItem("settings")??"";for(const e of Object.keys(settingsData))if(window.sf.elements[e][0])for(let t=0;t<window.sf.elements[e].length;t++)window.sf.elements[e][t].addEventListener("change",OnSettingsChange);else window.sf.elements[e].addEventListener("change",OnSettingsChange);window.sdel.addEventListener("click",(e=>{localStorage.removeItem("settings"),sessionStorage.removeItem("settings");for(const e of Object.keys(settingsData))settingsData[e]="";window.sout.textContent="",SettingsUpdateForm(),SettingsApply()})),window.sf.addEventListener("submit",(e=>e.preventDefault()))},SettingsApply=()=>{document.documentElement.classList.toggle("csd","dark"==settingsData.theme),document.documentElement.classList.toggle("csl","light"==settingsData.theme),document.documentElement.classList.toggle("csch","more"==settingsData.contrast),document.documentElement.classList.toggle("cscl","less"==settingsData.contrast),document.body.style.setProperty("--bw",`var(--b${settingsData.border_width||"1"})`)},SettingsUpdateForm=()=>{for(const e of Object.keys(settingsData))if(window.sf.elements[e][0])for(let t=0;t<window.sf.elements[e].length;t++)window.sf.elements[e][t].checked=window.sf.elements[e][t].value==settingsData[e];else window.sf.elements[e].value=settingsData[e]},OnSettingsChange=e=>{if(localStorage.removeItem("settings"),sessionStorage.removeItem("settings"),settingsData[e.target.name]=e.target.value??"",settingsData.data){const e={};for(const[t,n]of Object.entries(settingsData))n&&(e[t]=n);Object.keys(e).length&&("local_storage"==settingsData.data?localStorage.setItem("settings",JSON.stringify(e)):sessionStorage.setItem("settings",JSON.stringify(e)))}SettingsApply(),window.sout.textContent=sessionStorage.getItem("settings")??localStorage.getItem("settings")??""},UpdateBodyHasScrollbar=()=>{document.body.classList.toggle("sw",window.innerWidth>document.documentElement.clientWidth)},CSSVars=()=>{ScrollbarWidth(),window.addEventListener("resize",ScrollbarWidth,passive),window.addEventListener("resize",UpdateBodyHasScrollbar,passive)},ViewTransitions=()=>{if(!("startViewTransition"in document))return;let e=location.href.lastIndexOf("#"),t=-1==e?location.href:location.href.slice(0,e);const n="a:not([href='#content']):not([href^='mailto']):not(.nvt)";let o=null,s=null,a=null;const i=async(e,t=!1)=>{try{const i=document.startViewTransition((async()=>{s=e,a=new AbortController;let n=fetch(s,{signal:a.signal});t&&history.pushState(null,"",e);const o=document.querySelector("meta[name='description']"),i=document.querySelector("#h"),l=document.querySelector("#content"),r=document.querySelector("#f"),d=document.createElement("div");if(n=await n,!n.ok)throw document.title="404",l.innerHTML="<h1>404</h1>",new Error("404");d.innerHTML=await n.text(),s=null,a=null,document.title=d.querySelector("title").textContent,o.replaceWith(d.querySelector("meta[name='description']")),i.replaceWith(d.querySelector("#h")),l.replaceWith(d.querySelector("#content")),r.replaceWith(d.querySelector("#f"))}));await i.updateCallbackDone,t&&window.scrollTo(0,0),UpdateBodyHasScrollbar(),"undefined"!=typeof OptionalSyntaxHighlighting&&OptionalSyntaxHighlighting(),document.querySelectorAll(n).forEach((e=>e.addEventListener("click",l))),o=location.href,document.documentElement.dispatchEvent(new CustomEvent("viewchange")),await i.finished,mouseEffectsNodes=new Map,MouseEffects()}catch(e){console.debug(e)}},l=e=>{if((e.target.host??location.host)!=location.host)return;const n=e.target.href.lastIndexOf("#"),s=-1==n?e.target.href:e.target.href.slice(0,n);t!=s&&(t=s,e.preventDefault(),o=location.href,i(e.target.href,!0))};document.querySelectorAll(n).forEach((e=>e.addEventListener("click",l))),window.addEventListener("popstate",(e=>{const n=location.href.lastIndexOf("#"),l=-1==n?location.href:location.href.slice(0,n);t!=l&&(t=l,e.preventDefault(),null!==s&&(a.abort(),s=null,o==location.href)||i(location.href))}))};document.addEventListener("readystatechange",(e=>{if("complete"!=document.readyState)return;let t;ViewTransitions(),UpdateBodyHasScrollbar(),Settings(),MouseEffects();var n=()=>{if(!navigator.connection?.saveData){if(t)return void hljs.highlightAll();if(!document.querySelector("pre code"))return;const e=document.createElement("script");e.src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",document.head.appendChild(e),e.addEventListener("load",(()=>{t=!0,hljs.highlightAll()}));const n=document.createElement("link");n.rel="stylesheet",n.href="/hljs.css",document.head.appendChild(n)}};navigator.connection?.saveData||(document.documentElement.addEventListener("viewchange",n),n())}));let mouseEffectsNodes=new Map;const topName="--mpxt",leftName="--mpxl",meSetClass="mset",meStylesAttr="style";let meNode,mePos,meRect,meLeft,meTop;const MoveMouseEffects=e=>{for(meNode of mouseEffectsNodes)meNode[1][0]>window.innerHeight||meNode[1][0]<-window.innerHeight||(meNode[0].setAttribute("style",`${topName}:${e.clientY-meNode[1][0]}px;--mpxl:${e.clientX-meNode[1][1]}px`),meNode[0].classList.add("mset"))},ScrollMouseEffects=e=>{let t;for(const e of mouseEffectsNodes)t=e[0].getBoundingClientRect(),e[1][0]=Math.round(t.top),e[1][1]=Math.round(t.left)},MouseEffects=()=>{if("ontouchstart"in document.documentElement)return;let e;for(const t of document.querySelectorAll(".m, button, pre code"))e=t.getBoundingClientRect(),mouseEffectsNodes.set(t,[Math.round(e.top),Math.round(e.left)]);addEventListener("mousemove",MoveMouseEffects,passive),addEventListener("scroll",ScrollMouseEffects,passive),addEventListener("resize",ScrollMouseEffects,passive)};
