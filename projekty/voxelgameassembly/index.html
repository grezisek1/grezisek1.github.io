<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Voxel&shy;Game&shy;Assembly - Grezisek</title><meta name="description" content="Silnik do tworzenia gier 3D w przestrzeni voxelowej."><style>@font-face{font-family:Aleo;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/aleo/v14/c4mv1nF8G8_swAPJ0Q1o.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Aleo;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/aleo/v14/c4mv1nF8G8_swA3J0Q.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Comme;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/comme/v2/8QIHdirKhMbn-su3uI0crg.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Comme;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/comme/v2/8QIHdirKhMbn-su5uI0.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Comme;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/comme/v2/8QIHdirKhMbn-su3uI0crg.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Comme;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/comme/v2/8QIHdirKhMbn-su5uI0.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><link rel="stylesheet" href="/m.css"><script src="/m.js"></script></head><body class="sw"><a href="#content">Przeskocz do treści</a><div id="sp"><button id="so">Ustawienia</button><dialog id="sd"><div><h2>Ustawienia</h2><button id="sc">Zamknij</button><form id="sf"><fieldset class="g g1"><legend>Motyw:</legend><label><input type="radio" name="theme" value="">Automatyczny (urządzenie)</label><label><input type="radio" name="theme" value="dark">Ciemny</label><label><input type="radio" name="theme" value="light">Jasny</label></fieldset><fieldset class="g g1"><legend>Kontrast:</legend><label><input type="radio" name="contrast" value="">Automatyczny (urządzenie)</label><label><input type="radio" name="contrast" value="less">Normalny</label><label><input type="radio" name="contrast" value="more">Zwiększony</label></fieldset><fieldset class="g g1"><legend>Grubość obramówek:</legend><label><input type="radio" name="border_width" value="">Normalne</label><label><input type="radio" name="border_width" value="0">Cienkie</label><label><input type="radio" name="border_width" value="2">Grube</label></fieldset><fieldset class="g g1"><legend>Zapamiętywanie ustawień:</legend><label><input type="radio" name="data" value="">Brak</label><label><input type="radio" name="data" value="local_storage">Trwały zapis w przeglądarce (localStorage)</label><label><input type="radio" name="data" value="session_storage">Tymczasowy zapis w przeglądarce (sessionStorage)</label></fieldset><fieldset class="g g1"><legend>Zapisane ustawienia:</legend><code id="sout" class="m"></code><button id="sdel">Usuń zapisane ustawienia</button></fieldset></form></div></dialog></div><script>CSSVars();SettingsApply();</script><header id="h"><a class="l" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="33" height="41" viewBox="0 0 408 512"><g transform="translate(-368 -584)"><rect width="80" height="80" transform="translate(696 1016)" fill="var(--cc)" /><path d="M368,1096V584H776V800H696V656H448v360H552v80Z" fill="var(--cc)" /><path d="M552,1096V880H776v80H632v136Z" fill="var(--c)" /></g></svg>grezisek</a><a href="/artykuly/">artykuły</a><a href="/projekty/" class="aa">projekty</a><a href="mailto:grezisek@gmail.com">e-mail</a></header><article id="content"><header><h1>Voxel&shy;Game&shy;Assembly</h1><small><a href="https://www.khronos.org/webgl/" target="_blank">WebGL, WebGL2</a>,<a href="https://www.w3.org/TR/webgpu/" target="_blank">WebGPU</a>,<a href="https://html.spec.whatwg.org/multipage/workers.html" target="_blank">WebWorker</a>,<a href="https://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm)" target="_blank">DDA</a></small><p>Silnik do tworzenia gier 3D w przestrzeni voxelowej.</p><p>Voxele to odpowiedniki pixeli w przestrzeni 3D - to najmniejsze "kostki" przestrzeni, które trzymają własne dane (np. "jestem bryłą ziemi") i pełnią w silniku rolę fragmentów terenu, cegieł budynków, cieczy, roślin itd. Zacząłem projekt, żeby ćwiczyć układanie kodu, nauczyć się więcej o wydajności skryptów, strukturach danych i poznać część web developmentu, która wcześniej była mi obca - dźwięk i grafika.</p></header><section class="g g2"><h2>Pierwsze trójkąty</h2><div class="c11 g2"><img class="w" src="/img/voxelengine_first_triangles.png" alt="Pierwsze trójkąty narysowane przez silnik" width="200" height="163" loading="lazy"><p>Narysowanie pierwszych trójkątów z użyciem WebGL nie było trudne - musiałem nauczyć się podstaw języka glsl, w którym pisane są programy dla karty graficznej.
                Reszta niezbędnego kodu była krótka, a wraz z dokumentacją i przykładami w internecie, łatwa do zrozumienia.</p></div></section><section class="g g2"><h2>Pierwsze voxele</h2><div class="c11 cr g2"><img class="w" src="/img/voxelengine_first_voxel.png" alt="Pierwszy voxel narysowany przez silnik" width="200" loading="lazy"><p>Następnym zadaniem było narysowanie pierwszych voxeli.
                Niestety w tym celu musiałem zaprogramować kilka dodatkowych rzeczy, które pozwolą na wyświetlanie grafiki 3D - kamery, perspektywy i modelu pojedynczego voxela.
                Tym sposobem, w moim kodzie pojawiły się pierwsze obszerne dane.
                Kamera i perspektywa wymagają swoich macierzy, czyli serii 16 liczb.
                Model voxela to lista wszystkich punktów dla trójkątów, które tworzą kształt.
                Zacząłem przeczuwać problemy.</p></div></section><section class="g g2"><h2>Pierwsze problemy z wydajnością</h2><div class="c11 g2"><img class="w" src="/img/voxelengine_first_performance_issues.png" alt="Problemy z wydajnością podczas rysowania 125 voxeli - ilość klatek na sekundę spadła z 60 do 15" width="200" loading="lazy"><p>Pierwsza wersja kodu zaczynała pokazywać problemy z wydajnością podczas rysowania zaledwie 64 voxeli.
                Nie było w tym nic dziwnego - kod był wtedy w wersji, która miała jedynie zapewnić "jakieś" działanie.
                Wiele czynności mogło być zoptymalizowane lub całkowicie pominięte.
                Na przykład nie było potrzeby, żeby z każdą klatką animacji,
                lista wszystkich voxeli była od nowa kolejkowana w karcie graficznej - w rzeczywistej grze sytuacja,
                gdzie cały świat zmienia się 60 razy na sekundę, nigdy nie nastąpi.</p></div><div class="c11 cr g2"><img class="w" src="/img/voxelengine_performance_issues_1.png" alt="Niewielkie problemy z wydajnością podczas rysowania 8 tysięcy voxeli - ilość klatek na sekundę spadła z 60 do 40" width="200" loading="lazy"><p>Procesor wciąż nie dawał rady. Zaczynało być jasne, że mój kod potrzebował solidnej struktury,
                w której mógłbym najpierw zadeklarować jak najwięcej gotowych danych
                a potem tylko ich używać albo korzystać z nich jak ze ściągawek.
                Sposób działania samego WebGL jest w gruncie rzeczy bardzo podobny,
                więc po wprowadzeniu zmian, w kodzie zapanowała chwilowa harmonia.
                Płynność działania była zadowalająca nawet podczas rysowania 10 tysięcy voxeli.
                Mimo znacznej poprawy wiedziałem, że to nie wystarczy do zrobienia gry. Potrzebowałem kilku dodatkowych zer na końcu tej liczby.
                Przełom nastąpił, gdy zmieniłem wersję WebGL na nowszą i przeniosłem część pracy na kartę graficzną.
                Główną optymalizacją była zmiana sposobu rysowania - zamiast przesyłania listy punktów i ich kolorów dla wszystkich rogów trójkątów z osobna (jeden po drugim),
                zacząłem przesyłać jedynie listę pozycji gotowych voxeli a karta graficzna przejęła odpowiedzialność za trójkąty w środku (wszystkie naraz).</p></div><div class="c11 g2"><img class="w" src="/img/voxelengine_performance_issues_2.png" alt="Brak problemów z wydajnością podczas rysowania 4 milionów voxeli - ilość klatek na sekundę spadła z 60 do 30 z powodu obciążenia karty graficznej" width="200" loading="lazy"><p>Równolegle trwały prace nad wydajną strukturą do trzymania dużej ilości danych -
                trzymanie każdego voxela jako instancji klasy okazało się bardzo niewydajne
                i wymuszało częste przeszukiwanie całej listy w poszukiwaniu konkretnych voxeli.
                Po przetestowaniu kilku wariantów struktury OCTree, wybrałem podział świata na fragmenty podobne do pudełek.
                Znając wymiary i położenie pudełek, nie musiałem zapisywać pozycji każdego voxela z osobna.
                W roli pudełek zastosowałem oszczędną listę liczb od 0 (puste) do 255, oznaczającyh typy wszystkich voxeli w środku.
                Puste albo jednolicie wypełnione pudełka mogłem oznaczyć pojedynczą liczbą, co poprawiło wykorzystanie pamięci i ułatwiło pomijanie obliczeń w pustych i pełnych pudełkach.
                Taka struktura sprzyjała szybszemu odczytywaniu i zmienianiu wartości, niż OCTree, a oszczędności w pamięci były tak duże, że nie musiałem się przez jakiś czas martwić.
                W rezultacie użycie procesora spadło niemal do zera, a wydajność rysowania zwiększyła się do 4 milionów voxeli.</p></div></section><section class="g g2"><h2>Rozbudowa</h2><div class="c11 cr g2"><img class="w" src="/img/voxelengine_far_terrain_and_shadows_1.png" alt="Cień terenu łagodnie zanikający wraz z rosnącą odległością" width="200" loading="lazy"><p>Dodałem sterowanie do kamery, kolejkę rysującą wyłącznie najbliższą okolicę, podział na poziomy szczegółowości, podstawowe oświetlenie, dynamiczne cienie i dodatkową logikę redukującą ilość voxeli w kolejce rysowania.
                Najciekawsze są zdecydowanie cienie, które działają na zasadzie ray tracingu.
                Każdy voxel w najbliższym poziomie szczegółowości posiada swój własny promień, który wędruje w stronę słońca sprawdzając czy w coś uderzy.
                O wydajność cieni dba algorytm DDA, który pozwala zredukować ilość testów kolizji promieni z przeszkodami.</p></div><div class="c11 g2"><img class="w" src="/img/voxelengine_far_terrain_and_shadows_2.png" alt="Cień i światło na przykładzie jednolitych grup voxeli porozrzucanych w przestrzeni" width="200" loading="lazy"><p>Algorytm dodatkowo wykorzystuje naturę struktury danych, by omijać puste przestrzenie (puste pudełka) oraz samodzielnie wznawia pracę, gdy słońce wystarczająco zmieni swoją pozycję.
                Pobieranie i przetwarzanie okolicy trwało niestety zbyt długo, żeby praca odbyła się w ciągu jednej klatki animacji. Zaprogramowałem więc narzędzie oparte o funkcję-generator, które wykonuje pracę we fragmentach, aż przekroczy limit czasu i potrafi wrócić do momentu, w którym ostatnio przerwało.
                Dzięki temu, gracz może się poruszać płynnie po świecie, a praca obliczeniowa wykonywana jest w wolnej chwili.</p></div><div class="c11 cr g2"><img class="w" src="/img/voxelengine_collisions.png" alt="Kilka rezultatów testu kolizji z terenem" width="200" loading="lazy"><p>Po dodaniu warstwy abstrakcji z "graczem" i "wrogiem", ich wspólnego fragmentu ze "sterowaniem",
                przyszedł czas na wykrywanie voxeli pod nogami, wykrywanie ścian lub przeszkód i grawitację.
                Dzięki zastosowanej strukturze danych mogłem łatwo ograniczyć ilość potrzebnych obliczeń.
                Nie trzeba sprawdzać każdej zmiany pozycji (liczby po przecinku) - wystarczy moment zmiany voxela (liczby całkowite) lub całego pudełka (np. co 32 voxele).</p></div></section><section class="g g2"><h2>WebGPU</h2><img class="w" src="/img/voxelengine_webgpu.png" alt="Ogromna ilość voxeli, które powoli znikają w oddali, zmniejszając stopniowo ilość szczegółów" width="3332" height="1175" loading="lazy"><p>Najprawdopodobniej jestem teraz na skraju kolejnego przełomu - do użytku weszło nowe API, które przynosi większą kontrolę, wiele wbudowanych optymalizacji i nowe funkcje.
            Dla przykładu, dzięki nowemu rodzajowi programu dla karty graficznej (compute shader), wiele obliczeń może być teraz przeniesione z procesora na kartę graficzną, a ta potrafi wykonać obliczenia na wszystkich elementach w jednym momencie.
            Tyle nowości oznacza duże zmiany w aktualnym kodzie silnika ale też nowe możliwości i najpewniej dużo większą wydajność.</p></section><footer class="g g1"><a href="/projekty/">Powrót do projektów</a><a href="/">Powrót do strony głównej</a></footer></article><footer id="f" class="g113 g2"><address><a class="l" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="33" height="41" viewBox="0 0 408 512"><g transform="translate(-368 -584)"><rect width="80" height="80" transform="translate(696 1016)" fill="var(--cc)" /><path d="M368,1096V584H776V800H696V656H448v360H552v80Z" fill="var(--cc)" /><path d="M552,1096V880H776v80H632v136Z" fill="var(--c)" /></g></svg>grezisek</a><p>Full stack web developer</p><a href="mailto:grezisek@gmail.com">Napisz e-mail</a></address><div id="i"><details><summary class="m mh">Cel tej strony</summary><div><p>Przede wszystkim, chcę dostarczyć czytelnikom wszechstronnego materiału edukacyjnego
                z zakresu JavaScriptu.
                Strona stawia sobie za zadanie pomóc w nauce tego języka programowania poprzez
                przystępne tutoriale, praktyczne przykłady i ciekawe projekty.</p><p>Kolejnym celem jest prezentacja moich własnych projektów.
                Cieszę się, że mogę podzielić się moimi osiągnięciami z szeroką publicznością i
                pokazać, jak wykorzystuję JavaScript w praktyce.
                Moje projekty są różnorodne i obejmują zarówno drobne funkcje pomocnicze jak i
                wieloletnie projekty-giganty.
                Pragnę zainspirować innych programistów do eksperymentowania i tworzenia
                innowacyjnych rozwiązań.</p><p>Wreszcie, pragnę znaleźć pracę, która pozwoli mi wykorzystać moje doświadczenie w
                programowaniu i jednocześnie zapewni dynamiczne i kreatywne środowisko pracy.
                Cieszę się, że mogę zaprezentować swoje portfolio i udostępnić informacje o moich
                osiągnięciach na tej stronie.
                Liczę na to, że przyciągnie to uwagę pracodawców, którzy poszukują zdolnego i
                zaangażowanego programisty.</p></div></details><details><summary class="m mh">Ułatwienia dostępności</summary><div><p>Poprawa dostępności materiałów edukacyjnych jest jednym z głównych priorytetów
                technologicznych mojej strony internetowej.
                Ta została zaprojektowana i rozwijana zgodnie z wytycznymi WCAG w celu spełnienia co
                najmniej wersji AA.
                Oznacza to, że dokładam wszelkich starań, aby treści były czytelne, łatwe do
                nawigacji i dostępne dla osób z różnymi rodzajami niepełnosprawności oraz w trudnych
                warunkach.</p><p>Aby zapewnić jak największe dopasowanie, moja strona obsługuje automatyczne
                przełączanie między jasnym i ciemnym trybem.
                Możesz polegać na ustawieniach swojego urządzenia i oczekiwać przewidywalnych
                rezultatów (szczególnie braku nagłej, oślepiającej bieli w środku nocy).
                Strona automatycznie wykrywa też twoje preferencje ograniczonej ilości efektów ruchu
                i zmienia sposób animowania na bardziej przyjazny.</p><p>Ponadto, moja strona automatycznie redukuje zużycie internetu, wykrywając odpowiedni
                nagłówek HTTP i dostosowując zawartość.
                Dzięki temu, korzystając z wolniejszego połączenia internetowego lub ograniczonego
                pakietu danych, możesz nadal korzystać z treści strony w sposób efektywny i bez
                większych przeszkód.</p><p>Moja strona umożliwia pełne nawigowanie za pomocą klawiatury.
                Jeśli korzystasz z czytnika ekranowego lub masz trudności w obsłudze myszy, możesz
                swobodnie poruszać się po stronie i korzystać z jej funkcjonalności.</p><p>Dodatkowe dostosowanie strony do potrzeb lub upodobań jest możliwe poprzez panel
                ustawień.
                Możesz tam ręcznie kontrolować kontrast, przełączać między jasnym i ciemnym trybem,
                regulować grubość obramowań elementów interaktywnych, kontrolować sposób zapisu
                ustawień i zarządzać zapisanymi danymi.</p><p>Dążę do ciągłego doskonalenia dostępności mojej strony i monitorowania nowych
                wytycznych WCAG.
                Jeśli masz jakiekolwiek sugestie lub uwagi dotyczące dostępności mojej strony,
                proszę o kontakt.
                Cenię opinię użytkowników i jestem otwarty na wprowadzanie ulepszeń, aby zapewnić
                jak najlepsze doświadczenie dla wszystkich odwiedzających.</p></div></details><details><summary class="m mh">Polityka prywatności</summary><div><ol><li><b>Pliki cookie i śledzenie:</b>Ta strona internetowa nie używa plików cookie
                    ani śledzenia.
                    Nie gromadzę żadnych informacji o Twojej wizycie na stronie.</li><li><b>Dane przekazywane w mailu:</b>Jeśli skontaktujesz się ze mną, przesyłając
                    wiadomość e-mail, będę przetwarzać jedynie te dane, które dobrowolnie mi
                    udostępnisz w treści wiadomości.
                    Te informacje są używane wyłącznie w celu odpowiedzi na Twoje pytania i
                    zgłoszenia lub wcale.
                    Są to jednocześnie jedyne informacje o Tobie, do których mam dostęp.</li><li><b>Dane ustawień:</b>Strona może używać lokalnej pamięci przeglądarki do
                    zapamiętywania ustawień.
                    W odróżnieniu od cookie, te dane nie są wysyłane przez internet.
                    Zapamiętywanie ustawień jest opcjonalne i domyślnie nieaktywne.
                    Zapisane ustawienia możesz zobaczyć lub usunąć w panelu ustawień strony, w
                    grupie "Zapisane ustawienia" lub z poziomu panelu przeglądarki.</li><li><b>Udostępnianie danych:</b>Nie udostępniam żadnych przekazanych mi danych
                    osobom trzecim bez Twojej zgody, chyba że wymaga tego prawo.</li><li><b>Bezpieczeństwo:</b>Stosuję odpowiednie środki bezpieczeństwa, aby chronić
                    Twoje dane przed nieuprawnionym dostępem, utratą lub nieuprawnionym ujawnieniem.
                    Jednakże, żadna metoda przesyłania danych przez internet nie jest całkowicie
                    bezpieczna i nie mogę zagwarantować absolutnego bezpieczeństwa przekazywanych
                    informacji.</li><li><b>Zmiany w polityce prywatności:</b>Niniejsza polityka prywatności może być
                    okresowo aktualizowana.
                    Wszelkie istotne zmiany będą opublikowane na tej stronie.</li></ol></div></details></div><small>© grezisek 2023. Wszystkie prawa zastrzeżone.</small></footer></body></html>